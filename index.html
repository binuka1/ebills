<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>බිල්පත ඇතුළත් කරන්න - Yomesh Stores</title>
<style>
  body {
    overflow: scroll;
    font-family: Arial, sans-serif;
    max-width: 420px;
    margin: 20px auto;
    background: #f0f8ff;
    padding: 15px;
    box-sizing: border-box;
  }
  h1 {
    text-align: center;
    color: #004a99;
    margin-bottom: 10px;
  }
  form {
    background: white;
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
    color: #004a99;
  }
  select, input {
    width: 100%;
    padding: 8px 10px;
    margin-top: 6px;
    border-radius: 6px;
    border: 1.5px solid #aaa;
    font-size: 1rem;
    box-sizing: border-box;
  }
  button {
    margin-top: 20px;
    padding: 12px;
    width: 100%;
    font-size: 1.1rem;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:disabled {
    background: #80b3ff;
    cursor: not-allowed;
  }
  #historyBtn {
    background: #28a745;
    margin-top: 10px;
  }
</style>
</head>
<body>
<button id="historyBtn">බිල්පත් ඉතිහාසය</button>
<button id="reportBtn">Report</button>
<h1>Yomesh Stores - නව බිල්පතක් ඇතුළත් කරන්න</h1>

<form id="billForm" novalidate>
  <label for="billType">බිල් වර්ගය</label>
  <select id="billType" required>
    <option value="" disabled selected>-- තෝරන්න --</option>
    <option value="LECO">LECO</option>
    <option value="NWSDB">NWSDB</option>
    <option value="DIALOG TV">DIALOG TV</option>
  </select>

  <label for="accountNumber">ගිනුම් අංකය</label>
  <input type="text" id="accountNumber" inputmode="numeric" pattern="[0-9]*" required placeholder="ගිනුම් අංකය ඇතුළත් කරන්න" />

  <label for="referenceNumber">යොමු අංකය</label>
  <input type="text" id="referenceNumber" inputmode="numeric" pattern="[0-9]*" required placeholder="යොමු අංකය ඇතුළත් කරන්න" />

  <label for="baseAmount">ගාණ (රු.)</label>
  <input type="number" id="baseAmount" min="0" step="0.01" required placeholder="ගාණ ඇතුළත් කරන්න" />

  <label for="phoneNumber">දුරකථන අංකය</label>
  <input type="text" id="phoneNumber" inputmode="tel" pattern="[0-9]*" required placeholder="දුරකථන අංකය ඇතුළත් කරන්න" />

  <button type="submit" id="submitBtn">සම්පූර්ණ කරන්න</button>
</form>



<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
const billForm = document.getElementById('billForm');
const billType = document.getElementById('billType');
const accountNumber = document.getElementById('accountNumber');
const referenceNumber = document.getElementById('referenceNumber');
const baseAmount = document.getElementById('baseAmount');
const phoneNumber = document.getElementById('phoneNumber');
const submitBtn = document.getElementById('submitBtn');
const historyBtn = document.getElementById('historyBtn');

// Auto-focus logic
billType.addEventListener('change', () => { accountNumber.focus(); });
accountNumber.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); referenceNumber.focus(); }});
referenceNumber.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); baseAmount.focus(); }});
baseAmount.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); phoneNumber.focus(); }});
phoneNumber.addEventListener('keydown', (e) => { if(e.key==='Enter'){ e.preventDefault(); submitBtn.click(); }});

// History button click
historyBtn.addEventListener('click', () => {
  window.location.href = 'billHistory.html';
});

reportBtn.addEventListener('click', () => {
  window.location.href = 'report.html';
});

billForm.addEventListener('submit', e => {
  e.preventDefault();
  submitBtn.disabled = true;
  submitBtn.textContent = 'සම්පූර්ණ වෙමින්...';

  const today = new Date();
  const dateStr = today.toISOString().slice(0, 10);
  const timeStr = today.toTimeString().slice(0, 8);

  axios({
    method: "POST",
    url: "http://91.99.57.32/api/database/rows/table/710/?user_field_names=true",
    headers: {
      Authorization: "Token u2FLiMgoADbHyxbKwAoJVvBSJjIKChWU",
      "Content-Type": "application/json"
    },
    data: {
      bill_type: billType.value,
      account_number: accountNumber.value.trim(),
      reference_number: Number(referenceNumber.value.trim()),
      base_amount: Number(baseAmount.value),
      date: dateStr,
      time: timeStr,
      "Phone number": phoneNumber.value.trim() // ✅ phone number save
    }
  })
  .then(res => {
    const newId = res.data.id;
    window.location.href = `bill.html?id=${newId}`;
  })
  .catch(err => {
    alert('දෝෂයක්: ' + (err.response?.data?.error || err.message));
    submitBtn.disabled = false;
    submitBtn.textContent = 'සම්පූර්ණ කරන්න';
  });
});
</script>

</body>
</html>
